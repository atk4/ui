(window.webpackJsonpatk=window.webpackJsonpatk||[]).push([[3],{404:function(t,e,n){"use strict";e.a={name:"atk-date-picker",template:'<v-date-picker v-model="date" v-bind="datePickerProps" @input="onChange"></v-date-picker>',props:["value","datePickerProps","atkDateOptions"],data:function(){var t=this.atkDateOptions||{},e=t.useTodayDefault,n=void 0!==e&&e,i=t.phpDateFormat;return{useTodayDefault:n,phpDateFormat:void 0===i?"Y-m-d":i,date:null}},mounted:function(){this.useTodayDefault&&null===this.value?this.date=new Date:this.value&&(this.date=this.getDateFromString(this.value)),this.date&&this.$emit("dateChange",atk.phpDate(this.phpDateFormat,this.date))},computed:{},methods:{onChange:function(t){this.$emit("dateChange",atk.phpDate(this.phpDateFormat,t))},getDateFromString:function(t){return new Date(atk.utils.date().parse(t))}}}},446:function(t,e,n){"use strict";n.r(e);n(66),n(38),n(32),n(142),n(141),n(144),n(67),n(68),n(47),n(18),n(197),n(52),n(23),n(90),n(33);var i=n(412),a=n.n(i),o=n(146),r=n.n(o),l=(n(408),n(413)),s=n.n(l),u=n(20),c=n.n(u);n(73),n(59),n(143),n(145);function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var f={name:"atk-multiline-body",template:'\n    <sui-table-body>\n      <atk-multiline-row v-for="(row , idx) in rows" :key="getId(row)" \n      @onTabLastColumn="onTabLastColumn(idx)"\n      :fields="fields" \n      :rowId="getId(row)" \n      :isDeletable="isDeletableRow(row)" \n      :values="row"\n      :error="getError(getId(row))"></atk-multiline-row>\n    </sui-table-body>\n  ',props:["fieldDefs","rowData","rowIdField","deletables","errors"],data:function(){return{fields:this.fieldDefs}},created:function(){},components:{"atk-multiline-row":{name:"atk-multiline-row",template:'\n    <sui-table-row :verticalAlign="\'middle\'">\n        <sui-table-cell width="one" textAlign="center"><input type="checkbox" @input="onToggleDelete" v-model="toDelete"></input></sui-table-cell>\n        <sui-table-cell  @keydown.tab="onTab(idx)" v-for="(column, idx) in columns" :key="idx" :state="getErrorState(column)" :width="getColumnWidth(column)" :style="{overflow: \'visible\'}" v-if="column.isVisible" :textAlign="getTextAlign(column)">\n         <atk-multiline-cell \n           :componentName="getMapComponent(column)" \n           :cellData="column" \n           @update-value="onUpdateValue"\n           @post-value="onPostRow"\n           :fieldValue="getValue(column)"\n           :componentProps="getComponentProps(column)"></atk-multiline-cell>\n        </sui-table-cell>\n    </sui-table-row>\n  ',props:["fields","rowId","isDeletable","values","error"],data:function(){return{columns:this.fields}},components:{"atk-multiline-cell":{name:"atk-multiline-cell",template:' \n    <component :is="componentName"\n        :fluid="true"  \n        class="fluid" \n        @blur="onBlur"\n        @input="onInput"\n        @dateChange="onDateChange"\n        v-model="inputValue"\n        :readOnlyValue="fieldValue"\n        :name="fieldName"\n        ref="cell"\n        v-bind="componentProps"></component>\n  ',components:{"atk-multiline-readonly":{template:"<div>{{readOnlyValue}}</div>",name:"atk-multiline-readonly",props:["readOnlyValue"]},"atk-multiline-textarea":{name:"atk-textarea",template:'<textarea v-model="text" @input="handleChange"></textarea>',props:{value:[String,Number]},data:function(){return{text:this.value}},methods:{handleChange:function(t){this.$emit("input",t.target.value)}}},"atk-date-picker":n(404).a},props:["cellData","componentName","fieldValue","options","componentProps"],data:function(){return{field:this.cellData.field,type:this.cellData.type,fieldName:"-"+this.cellData.field,inputValue:this.fieldValue,dirtyValue:this.fieldValue}},computed:{isDirty:function(){return this.dirtyValue!==this.inputValue}},methods:{onInput:function(t){this.inputValue=this.getTypeValue(t),this.$emit("update-value",this.field,this.inputValue)},onDateChange:function(t){this.onInput(t)},onBlur:function(t){this.isDirty&&(this.$emit("post-value",this.field),this.dirtyValue=this.inputValue)},getTypeValue:function(t){var e=t;return"boolean"===this.type&&(e=t.target.checked),e}}}},inject:["getRootData"],computed:{toDelete:{get:function(){return this.isDeletable},set:function(t){return t}}},methods:{onTab:function(t){t===this.columns.filter((function(t){return t.isEditable})).length&&this.$emit("onTabLastColumn")},getErrorState:function(t){if(this.error&&this.error.filter((function(e){return t.field===e.field})).length>0)return"error";return null},getColumnWidth:function(t){return t.fieldOptions?t.fieldOptions.width:null},onEdit:function(){this.isEditing=!0},onToggleDelete:function(t){atk.eventBus.emit(this.$root.$el.id+"-toggle-delete",{rowId:this.rowId})},onUpdateValue:function(t,e){atk.eventBus.emit(this.$root.$el.id+"-update-row",{rowId:this.rowId,field:t,value:e})},onPostRow:function(t){atk.eventBus.emit(this.$root.$el.id+"-post-row",{rowId:this.rowId,field:t})},getReadOnlyValue:function(t){return t.isEditable?null:this.getValue(t)},getValue:function(t){var e=t.default;return this.values.forEach((function(n){t.field in n&&(e=n[t.field])})),e},getComponentProps:function(t){var e={},n=t.fieldOptions||{};switch(t.component){case"dropdown":(e=h(h({floating:!0,closeOnBlur:!0,openOnFocus:!1,selection:!0},this.getRootData().data.options.suiDropdown||{}),n)).options=this.getEnumValues(n.values||null);break;case"date":e={datePickerProps:h({locale:"en-En",masks:{input:"YYYY-MM-DD"},popover:{placement:"bottom",visibility:"click"}},this.getRootData().data.options.datePickerProps||{}),atkDateOptions:h({phpDateFormat:"Y-m-d"},this.getRootData().data.options.atkDateOptions||{})};break;default:e=Object.assign(e,n)}return e},getEnumValues:function(t){if(t)return Object.keys(t).map((function(e){return{key:e,value:e,text:t[e]}}))},getMapComponent:function(t){var e;if(t.isEditable)switch(t.component){case"input":case"dropdown":case"checkbox":e="sui-"+t.component;break;case"textarea":e="atk-multiline-textarea";break;case"date":e="atk-date-picker";break;default:e="sui-input"}else e="atk-multiline-readonly";return e},getTextAlign:function(t){var e;switch(t.fieldOptions?t.fieldOptions.type:"text"){case"money":case"integer":case"number":e="right";break;default:e="left"}return e}},getDateFromString:function(t){return t?new Date(atk.exec().dateParse(t)):new Date}}},computed:{rows:function(){return this.rowData}},methods:{onTabLastColumn:function(t){t+1===this.rowData.length&&this.$emit("onTabLastRow")},isDeletableRow:function(t){return this.deletables.indexOf(this.getId(t))>-1},getId:function(t){var e;return t.forEach((function(t){"__atkml"in t&&(e=t.__atkml)})),e},getError:function(t){return t in this.errors?this.errors[t]:null}}},p={name:"atk-multiline-header",template:'\n     <sui-table-header>\n       <sui-table-row v-if="hasError()">\n        <sui-table-cell :style="{background:\'none\'}"></sui-table-cell>\n        <sui-table-cell :style="{background:\'none\'}" state="error" v-for="(column, idx) in columns" :key="idx" v-if="column.isVisible" :textAlign="getTextAlign(column)"><sui-icon name="attention" v-if="getErrorMsg(column)"></sui-icon>{{getErrorMsg(column)}}</sui-table-cell>\n      </sui-table-row>\n       <sui-table-row v-if="hasCaption()">\n        <sui-table-headerCell :colspan="getVisibleColumns()">{{caption}}</sui-table-headerCell>\n       </sui-table-row>\n        <sui-table-row :verticalAlign="\'top\'">\n        <sui-table-header-cell width="one" textAlign="center"><input type="checkbox" @input="onToggleDeleteAll" :checked.prop="isChecked" :indeterminate.prop="isIndeterminate" ref="check"></input></sui-table-header-cell>\n        <sui-table-header-cell v-for="(column, idx) in columns" :key="idx" v-if="column.isVisible" :textAlign="getTextAlign(column)">\n         <div>{{column.caption}}</div>\n         <div :style="{position: \'absolute\', top: \'-22px\'}" v-if="false"><sui-label pointing="below" basic color="red" v-if="getErrorMsg(column)">{{getErrorMsg(column)}}</sui-label></div>\n        </sui-table-header-cell>\n      </sui-table-row>\n    </sui-table-header>\n  ',props:["fields","state","errors","caption"],data:function(){return{columns:this.fields,isDeleteAll:!1}},methods:{onToggleDeleteAll:function(){var t=this;this.$nextTick((function(){atk.eventBus.emit(t.$root.$el.id+"-toggle-delete-all",{isOn:t.$refs.check.checked})}))},getTextAlign:function(t){var e="left";if(!t.isEditable)switch(t.type){case"money":case"integer":case"number":e="right"}return e},getVisibleColumns:function(){var t=1;return this.columns.forEach((function(e){t=e.isVisible?t+1:t})),t},hasError:function(){return Object.keys(this.errors).length>0},hasCaption:function(){return this.caption},getErrorMsg:function(t){if(this.hasError())for(var e=Object.keys(this.errors),n=0;n<e.length;n++){var i=this.errors[e[n]].filter((function(e){return e.field===t.field}));if(i.length>0)return i[0].msg}return null}},computed:{isIndeterminate:function(){return"indeterminate"===this.state},isChecked:function(){return"on"===this.state}}};function m(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function b(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?m(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var g,w;e.default={name:"atk-multiline",template:'<div>\n                <sui-table v-bind="tableProp">\n                  <atk-multiline-header :fields="fieldData" :state="getMainToggleState" :errors="errors" :caption="caption"></atk-multiline-header>\n                  <atk-multiline-body @onTabLastRow="onTabLastRow" :fieldDefs="fieldData" :rowData="rowData" :rowIdField="idField" :deletables="getDeletables" :errors="errors"></atk-multiline-body>\n                  <sui-table-footer>\n                    <sui-table-row>\n                        <sui-table-header-cell/>\n                        <sui-table-header-cell :colspan="getSpan" textAlign="right">\n                        <div is="sui-button-group">\n                         <sui-button size="small" @click.stop.prevent="onAdd" type="button" icon="plus" ref="addBtn" :disabled="isLimitReached"></sui-button>\n                         <sui-button size="small" @click.stop.prevent="onDelete" type="button" icon="trash" :disabled="isDeleteDisable"></sui-button>                        \n                         </div>\n                        </sui-table-header-cell>\n                    </sui-table-row>\n                  </sui-table-footer>\n                </sui-table>\n             </div>',props:{data:Object},data:function(){return{linesField:this.data.linesField,rows:[],fieldData:this.data.fields,idField:this.data.idField,eventFields:this.data.eventFields,deletables:[],hasChangeCb:this.data.hasChangeCb,errors:{},caption:this.data.caption?this.data.caption:null,tableDefault:{basic:!1,celled:!1,size:null,compact:null,collapsing:!1,stackable:!1,inverted:!1,color:null,columns:null},tableProp:b(b({},this.tableDefault),this.data.options.suiTable||{})}},components:{"atk-multiline-body":f,"atk-multiline-header":p},mounted:function(){var t=this;atk.eventBus.on(this.$root.$el.id+"-update-row",(function(e){t.updateRow(e.rowId,e.field,e.value)})),atk.eventBus.on(this.$root.$el.id+"-post-row",(function(e){t.hasExpression()&&t.postRow(e.rowId,e.field),t.hasChangeCb&&t.eventFields.indexOf(e.field)>-1&&t.postRaw()})),atk.eventBus.on(this.$root.$el.id+"-toggle-delete",(function(e){var n=t.deletables.indexOf(e.rowId);n>-1?t.deletables.splice(n,1):t.deletables.push(e.rowId)})),atk.eventBus.on(this.$root.$el.id+"-toggle-delete-all",(function(e){t.deletables=[],e.isOn&&t.rowData.forEach((function(e){t.deletables.push(t.getId(e))}))})),atk.eventBus.on(this.$root.$el.id+"-multiline-rows-error",(function(e){t.errors=b({},e.errors)}))},created:function(){var t=this;this.rowData=this.getInitData(),this.$nextTick((function(){t.updateLinesField()}))},methods:{getUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:11&e).toString(16)}))},onAdd:function(){this.rowData.push(this.newDataRow()),this.updateLinesField(),this.data.afterAdd&&"function"==typeof this.data.afterAdd&&this.data.afterAdd(JSON.parse(this.getInputElement().value))},onDelete:function(){var t=this;this.deletables.forEach((function(e){t.deleteRow(e)})),this.deletables=[],this.data.afterDelete&&"function"==typeof this.data.afterDelete&&this.data.afterDelete(JSON.parse(this.getInputElement().value))},deleteRow:function(t){var e=this.findRowIndex(t);e>-1&&(this.rowData.splice(e,1),delete this.errors[t]),this.updateLinesField(),this.hasChangeCb&&this.postRaw()},findRowIndex:function(t){for(var e=0;e<this.rowData.length;e++)if(this.getId(this.rowData[e])===t)return e;return-1},postRow:(w=s()(a.a.mark((function t(e){var n,i,o,l,s=this;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=-1,i=function(t){s.rowData[t].forEach((function(i){i.__atkml===e&&(n=t)}))},o=0;o<this.rowData.length;o++)i(o);return t.next=5,this.postData(r()(this.rowData[n]));case 5:(l=t.sent).expressions&&Object.keys(l.expressions).forEach((function(t){s.updateFieldInRow(n,t,l.expressions[t])}));case 7:case"end":return t.stop()}}),t,this)}))),function(t){return w.apply(this,arguments)}),updateRow:function(t,e,n){for(var i=this,a=-1,o=function(e){i.rowData[e].forEach((function(n){n.__atkml===t&&(a=e)}))},r=0;r<this.rowData.length;r++)o(r);this.updateFieldInRow(a,e,n),this.clearError(t,e),this.updateLinesField()},clearError:function(t,e){if(t in this.errors){var n=this.errors[t].filter((function(t){return t.field!==e}));this.errors[t]=r()(n),0===n.length&&delete this.errors[t]}},updateFieldInRow:function(t,e,n){this.rowData[t].forEach((function(t){e in t&&(t[e]=n)}))},updateLinesField:function(){var t=document.getElementsByName(this.linesField)[0],e=this.rowData.map((function(t){for(var e={},n=0;n<t.length;n++){e[Object.keys(t[n])[0]]=Object.values(t[n])[0]}return b({},e)}));t.value=JSON.stringify(e)},getInitData:function(){var t=this,e=[],n=this.data.fields.map((function(t){return t.field})),i=document.getElementsByName(this.linesField)[0];if(i){var a=JSON.parse(i.value);(a=Array.isArray(a)?a:[]).forEach((function(i){var a=n.map((function(t){return c()({},t,i[t]?i[t]:null)}));a.push({__atkml:t.getUUID()}),e.push(a)}))}return e},newDataRow:function(){var t=[];return t.push({__atkml:this.getUUID()}),this.data.fields.forEach((function(e){t.push(c()({},e.field,e.default))})),t},getId:function(t){var e;return t.forEach((function(t){"__atkml"in t&&(e=t.__atkml)})),e},hasExpression:function(){return this.fieldData.filter((function(t){return t.isExpr})).length>0},postRaw:function(){jQuery(this.$refs.addBtn.$el).api({on:"now",url:this.data.url,method:"post",data:{__atkml_action:"on-change",rows:JSON.stringify(this.rowData)}})},postData:(g=s()(a.a.mark((function t(e){var n,i,o;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={},i=this.$refs.addBtn.$el,this.fieldData.map((function(t){return t.field})).forEach((function(t){n[t]=e.filter((function(e){return t in e}))[0][t]})),n.__atkml_action="update-row",t.prev=5,t.next=8,atk.apiService.suiFetch(this.data.url,{data:n,method:"post",stateContext:i});case 8:return o=t.sent,t.abrupt("return",o);case 12:t.prev=12,t.t0=t.catch(5),console.error(t.t0);case 15:case"end":return t.stop()}}),t,this,[[5,12]])}))),function(t){return g.apply(this,arguments)}),getInputElement:function(){return document.getElementsByName(this.linesField)[0]},onTabLastRow:function(){!this.isLimitReached&&this.data.addOnTab&&this.onAdd()}},computed:{rowData:{get:function(){return this.rows},set:function(t){this.rows=r()(t)}},getSpan:function(){return this.fieldData.length-1},getDeletables:function(){return this.deletables},getMainToggleState:function(){var t="off";return this.deletables.length>0&&(t=this.deletables.length===this.rowData.length?"on":"indeterminate"),t},isDeleteDisable:function(){return!this.deletables.length>0},isLimitReached:function(){return 0!==this.data.rowLimit&&this.data.rowLimit<this.rowData.length+1}}}}}]);